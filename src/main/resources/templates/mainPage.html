<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/mainPage/category-suggestions.css">
    <link rel="stylesheet" href="/css/mainPage/outfit-display.css">
    <link rel="stylesheet" href="/css/mainPage/weather-info.css">
    <link rel="stylesheet" href="/css/mainPage/clothing-combination.css">

    <!-- PWA 관련 -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="/images/otneul-logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>Otneul</title>
</head>
<body>
<header>
    <a href="/" class="header-left">
        <img src="/images/otneul-logo2.png" alt="로고" class="logo">
        <h1>옷늘</h1>
    </a>

    <div class="header-right">
        <button class="menu-toggle-button">
            <img src="/images/ui-icons/bx-menu.svg" alt="메뉴 아이콘" class="menu-icon">
        </button>
    </div>
</header>

<div class="menu-container">
    <ul class="menu">
        <li><a href="/location/select" class="button">지역 선택으로 이동</a></li>
        <li><a href="https://github.com/M1nKyu/weather-clothes" class="button">서비스 소개 (GitHub)</a></li>
    </ul>
</div>

<script src="/js/menu-toggle.js"></script>

<!-- 날씨 정보 영역 -->
<main>
    <div class="main-content" th:if="${fcstWeather != null}">
        <!-- 날씨 정보  -->
        <div class="weather-info" th:style="|background-image: url('@{${weatherInfoBackground}}')|">
            <div class="location">
                <h2 th:text="${userLocation[1]} + ' ' + ${userLocation[2]}">서울</h2>
                <a th:if="${userLocation != null and userLocation[0] == 'default'}" th:href="@{/location/select}">위치를 설정하세요</a>
            </div>
            <div class="current-weather">
                <div class="current-temperature">
                    <img th:src="@{${nowWeather.icon}}" class="weather-icon" alt="현재 날씨 아이콘">
                    <span class="temperature" th:text="${nowWeather.t1h} + '°'"></span>
                </div>
                <div class="pty-information">
                    <p th:if="${weatherDetails['pty']}" class="weather-detail">
                        <span th:text="${weatherDetails['pty']}"></span>
                    </p>
                </div>
                <div class="weather-details">
                    <p th:if="${weatherDetails['sky']}" class="weather-detail">
                        <span class="label">하늘:</span>
                        <span th:text="${weatherDetails['sky']}"></span>
                    </p>
                    <p th:if="${weatherDetails['wsd']}" class="weather-detail">
                        <span class="label">풍속:</span>
                        <span th:text="${weatherDetails['wsd']}"></span>
                    </p>
                    <p th:if="${weatherDetails['reh']}" class="weather-detail">
                        <span class="label">습도:</span>
                        <span th:text="${weatherDetails['reh']} + '%'"></span>
                    </p>
                </div>
            </div>
            <div class="hourly-forecast">
                <div class="hour-item" th:each="weather : ${fcstWeather}">
                    <p class="hour-item-time" th:text="${weather.fcstTime}">10시</p>
                    <img th:src="@{${weather.icon}}" alt="날씨 아이콘">
                    <p class="hour-item-temp" th:text="${weather.t1h} + '°'">15°</p>
                </div>
            </div>
        </div>

        <div class="category-suggestions">
            <h2>지금 날씨에는</h2>
            <div th:each="category : ${clothingCategory}" class="recommendation-category">
                <h3 th:text="${category.key}" class="category-title"></h3>
                <ul class="recommendation-list">
                    <li th:each="clothing : ${category.value}" th:text="${clothing.categoryName}"></li> <!-- ClothingCategory의 CategoryName 출력 -->
                </ul>
            </div>
        </div>

        <div class="clothing-combination">
            <h2>추천 조합 및 색상</h2>
            <div class="content-wrapper">
                <div class="combination-container">
                    <h2>추천 조합</h2>
                    <div th:each="combination : ${clothingCombination}" class="combination">
                        <ul>
                            <li>
                                <span class="category-name" th:text="${combination.mainCategory}"></span>:
                                <span class="clothing-name" th:text="${combination.clothingCategory.categoryName}"></span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="color-recommendations">
                    <h2>색상 조합</h2>
                    <div th:each="combination : ${clothingCombination}" class="color-item">
                        <span class="category-name" th:text="${combination.mainCategory}"></span>:
                        <svg>
                            <!-- 아우터: 자켓 모양 -->
                            <svg th:if="${combination.mainCategory == '아우터'}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                <g>
                                    <rect x="165.003" y="57.534" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -16.5617 165.5928)" width="53.208" height="90.508" th:attr="fill=${combination.color}"></rect>
                                    <polygon points="219.153,38.4 256,75.247 292.847,38.4" th:attr="fill=${combination.color}"></polygon>
                                    <rect x="275.134" y="76.183" transform="matrix(0.7071 -0.7071 0.7071 0.7071 21.1578 256.6541)" width="90.508" height="53.208" th:attr="fill=${combination.color}"></rect>
                                    <path d="M204.8,207.907l-73.14-73.141c-12.518-12.518-33.659-8.856-41.238,7.142L0,332.8l76.8,38.4l38.4-76.8v179.2h121.6V175.907 L204.8,207.907z M204.8,435.2h-51.2v-38.4h51.2V435.2z" th:attr="fill=${combination.color}"></path>
                                    <path d="M421.578,141.908c-7.579-15.999-28.721-19.661-41.238-7.142l-73.14,73.141l-32-32V473.6h121.6V294.4l38.4,76.8l76.8-38.4 L421.578,141.908z M358.4,435.2h-51.2v-38.4h51.2V435.2z M358.4,294.4h-51.2V256h51.2V294.4z" th:attr="fill=${combination.color}"></path>
                                </g>
                            </svg>

                            <!-- 상의: 티셔츠 모양 -->
                            <svg th:if="${combination.mainCategory == '상의'}" th:attr="fill=${combination.color}" height="200px" width="200px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 304.43 304.43" xml:space="preserve">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <path d="M302.819,177.89l-84.082-85.638c-4.173-4.25-9.878-6.644-15.834-6.644h-15.689V64.044c0-3.104-2.517-5.621-5.621-5.621h-60.425c-3.104,0-5.621,2.517-5.621,5.621v21.564h-14.022c-5.956,0-11.661,2.394-15.834,6.644L1.61,177.89c-2.045,2.083-2.155,5.385-0.254,7.6l17.714,20.631c1.903,2.216,5.186,2.606,7.555,0.896l58.162-41.983l-6.998,74.828c-0.147,1.575,0.376,3.139,1.441,4.309c1.065,1.169,2.574,1.836,4.155,1.836h137.658c1.582,0,3.09-0.667,4.156-1.836c1.065-1.169,1.588-2.734,1.441-4.309l-6.998-74.828l58.162,41.983c2.368,1.71,5.652,1.32,7.555-0.896l17.714-20.631C304.975,183.275,304.865,179.973,302.819,177.89z"></path>
                                </g>
                            </svg>


                            <!-- 바지: 바지 모양 -->
                            <svg th:if="${combination.mainCategory == '바지'}" fill="#6c3d3d" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512.004 512.004" xml:space="preserve" stroke="#6c3d3d">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <path d="M475.366,281.783L366.753,173.171c-3.328-3.337-8.73-3.337-12.066,0l-22.613,22.622l120.67,120.678l22.622-22.622 C478.702,290.513,478.702,285.12,475.366,281.783z"></path>
                                    <path d="M264.533,263.326V68.271H87.543l-52.25,89.566c-1.007,1.741-1.374,3.789-1.033,5.768l59.733,341.333 c0.717,4.087,4.267,7.066,8.405,7.066h153.6c4.181,0,7.484-3.055,8.226-7.014l176.452-176.452L319.999,207.859L264.533,263.326z M213.333,128.004v8.533c0,4.71-3.814,8.533-8.533,8.533s-8.533-3.823-8.533-8.533v-8.533h-68.267 c-4.719,0-8.533-3.823-8.533-8.533c0-4.71,3.814-8.533,8.533-8.533h68.267c0-4.71,3.814-8.533,8.533-8.533 s8.533,3.823,8.533,8.533c4.719,0,8.533,3.823,8.533,8.533C221.866,124.181,218.051,128.004,213.333,128.004z"></path>
                                    <rect x="162.133" y="0" width="34.133" height="51.2"></rect>
                                    <path d="M264.533,8.538c0-4.71-3.814-8.533-8.533-8.533h-42.667v51.2h51.2V8.538z"></path>
                                    <path d="M145.066,0.004h-42.667c-4.719,0-8.533,3.823-8.533,8.533v42.667h51.2V0.004z"></path>
                                </g>
                            </svg>


                            <!-- 스커트: 스커트 모양 -->
                            <path th:if="${combination.mainCategory == '스커트'}" d="M15,5 L35,5 L30,35 L20,35 Z" th:attr="fill=${combination.color}"></path>
                        </svg>
                    </div>
                </div>


            </div>
        </div>

        <div class="outfit-display">
            <div class="outfit-display-header">
                <h2>추천 상품</h2>
                <!-- Swiper 버튼들 -->
                <div class="swiper-buttons">
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-button-next"></div>
                </div>
            </div>
            <!-- Swiper -->
            <div class="swiper productSwiper">
                <div class="swiper-wrapper">
                    <div th:each="mainCategory : ${clothingProducts}" class="swiper-slide">
                        <div class="product-categories">
                            <h3 th:text="${mainCategory.key}" class="main-category-title"></h3>
                            <div class="category-container">
                                <!-- 서브 카테고리 버튼들 -->
                                <div class="sub-category-buttons">
                                    <button class="scroll-button-left">
                                        <img src="/images/ui-icons/arrow-left.svg" alt="Left Arrow">
                                    </button>
                                    <div class="sub-category-buttons-container">
                                        <button th:each="category : ${mainCategory.value}"
                                                class="sub-category-button"
                                                th:data-category="${category.key}"
                                                onclick="showProducts(this.getAttribute('data-category'))">
                                            <span th:text="${category.key}"></span>
                                        </button>
                                    </div>
                                    <button class="scroll-button-right">
                                        <img src="/images/ui-icons/arrow-right.svg" alt="Right Arrow">
                                    </button>
                                </div>
                                <!-- 상품 표시 영역 -->
                                <div class="products-display-area">
                                    <div th:each="category : ${mainCategory.value}"
                                         th:id="'products-' + ${#strings.replace(category.key, ' ', '-')}"
                                         class="product-list hidden">
                                        <div class="product-item" th:each="product : ${category.value}">
                                            <a th:href="${product.link}" target="_self" class="product-link">
                                                <img th:src="${product.imageUrl}" th:alt="상품이미지" class="product-image">
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="swiper-pagination"></div>
            </div>
        </div>
    </div>
</main>

<footer class="footer">
    <div class="container">
        <button onclick="scrollToSectionByClass('weather-info')">날씨 정보</button>
        <button onclick="scrollToSectionByClass('category-suggestions')">카테고리</button>
        <button onclick="scrollToSectionByClass('clothing-combination')">추천 조합</button>
        <button onclick="scrollToSectionByClass('outfit-display')">추천 의상</button>
    </div>
</footer>


<!-- 날씨 데이터가 없을 때 -->
<div th:if="${weatherData == null}" class="error-message">
    <p th:text="${message}">Location data not found in cookies.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="/js/productSwiper.js"></script>
<script src="/js/product-toggle.js"></script>
<script src="/js/scroll-buttons.js"></script>
<script src="/js/footer-buttons.js"></script>


<script src="/service-worker.js"></script>

<!-- PWA 서비스워커 등록 -->
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker 등록 성공:', registration);
                })
                .catch(err => {
                    console.log('ServiceWorker 등록 실패:', err);
                });
        });
    }
</script>

<script src="/js/weather-update.js"></script>

</body>
</html>