<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/mainPage/category-suggestions.css">
    <link rel="stylesheet" href="/css/mainPage/outfit-display.css">
    <link rel="stylesheet" href="/css/mainPage/weather-info.css">
    <link rel="stylesheet" href="/css/mainPage/clothing-combination.css">

    <!-- PWA 관련 -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="/images/otneul-logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>Otneul</title>
</head>
<body>
<header>
    <a href="/" class="header-left">
        <img src="/images/otneul-logo2.png" alt="로고" class="logo">
        <h1>옷늘</h1>
    </a>

    <div class="header-right">
        <button class="menu-toggle-button">
            <img src="/images/ui-icons/bx-menu.svg" alt="메뉴 아이콘" class="menu-icon">
        </button>
    </div>
</header>

<div class="menu-container">
    <ul class="menu">
        <li><a href="/location/select" class="button">지역 선택으로 이동</a></li>
        <li><a href="https://github.com/M1nKyu/weather-clothes" class="button">서비스 소개 (GitHub)</a></li>
    </ul>
</div>

<script src="/js/menu-toggle.js"></script>

<!-- 날씨 정보 영역 -->
<main>
    <div class="main-content" th:if="${fcstWeather != null}">
        <!-- 날씨 정보  -->
        <div class="weather-info" th:style="|background-image: url('@{${weatherInfoBackground}}')|">
            <div class="location">
                <h2 th:text="${userLocation[1]} + ' ' + ${userLocation[2]}">서울</h2>
                <a th:if="${userLocation != null and userLocation[0] == 'default'}" th:href="@{/location/select}">위치를 설정하세요</a>
            </div>
            <div class="current-weather">
                <div class="current-temperature">
                    <img th:src="@{${nowWeather.icon}}" class="weather-icon" alt="현재 날씨 아이콘">
                    <span class="temperature" th:text="${nowWeather.t1h} + '°'"></span>
                </div>
                <div class="pty-information">
                    <p th:if="${weatherDetails['pty']}" class="weather-detail">
                        <span th:text="${weatherDetails['pty']}"></span>
                    </p>
                </div>
                <div class="weather-details">
                    <p th:if="${weatherDetails['sky']}" class="weather-detail">
                        <span class="label">하늘:</span>
                        <span th:text="${weatherDetails['sky']}"></span>
                    </p>
                    <p th:if="${weatherDetails['wsd']}" class="weather-detail">
                        <span class="label">풍속:</span>
                        <span th:text="${weatherDetails['wsd']}"></span>
                    </p>
                    <p th:if="${weatherDetails['reh']}" class="weather-detail">
                        <span class="label">습도:</span>
                        <span th:text="${weatherDetails['reh']} + '%'"></span>
                    </p>
                </div>
            </div>
            <div class="hourly-forecast">
                <div class="hour-item" th:each="weather : ${fcstWeather}">
                    <p class="hour-item-time" th:text="${weather.fcstTime}">10시</p>
                    <img th:src="@{${weather.icon}}" alt="날씨 아이콘">
                    <p class="hour-item-temp" th:text="${weather.t1h} + '°'">15°</p>
                </div>
            </div>
        </div>

        <div class="category-suggestions">
            <h2>지금 날씨에는</h2>
            <div th:each="category : ${clothingCategory}" class="recommendation-category">
                <h3 th:text="${category.key}" class="category-title"></h3>
                <ul class="recommendation-list">
                    <li th:each="clothing : ${category.value}" th:text="${clothing.categoryName}"></li> <!-- ClothingCategory의 CategoryName 출력 -->
                </ul>
            </div>
        </div>

        <div class="clothing-combination">
            <h2>추천 조합 및 색상</h2>
            <div class="content-wrapper">
                <div class="combination-container">
                    <h2>추천 조합</h2>
                    <div th:each="combination : ${clothingCombination}" class="combination">
                        <ul>
                            <li>
                                <span class="category-name" th:text="${combination.mainCategory}"></span>:
                                <span class="clothing-name" th:text="${combination.clothingCategory.categoryName}"></span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="color-recommendations">
                    <h2>색상 조합</h2>
                    <div th:each="combination : ${clothingCombination}" class="color-item">
                        <span class="category-name" th:text="${combination.mainCategory}"></span>:
                        <svg width="50" height="50">
                            <!-- 아우터: 자켓 모양 -->
                            <svg th:if="${combination.mainCategory == '아우터'}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="50" height="50">
                                <g>
                                    <rect x="165.003" y="57.534" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -16.5617 165.5928)" width="53.208" height="90.508" th:attr="fill=${combination.color}"></rect>
                                    <polygon points="219.153,38.4 256,75.247 292.847,38.4" th:attr="fill=${combination.color}"></polygon>
                                    <rect x="275.134" y="76.183" transform="matrix(0.7071 -0.7071 0.7071 0.7071 21.1578 256.6541)" width="90.508" height="53.208" th:attr="fill=${combination.color}"></rect>
                                    <path d="M204.8,207.907l-73.14-73.141c-12.518-12.518-33.659-8.856-41.238,7.142L0,332.8l76.8,38.4l38.4-76.8v179.2h121.6V175.907 L204.8,207.907z M204.8,435.2h-51.2v-38.4h51.2V435.2z" th:attr="fill=${combination.color}"></path>
                                    <path d="M421.578,141.908c-7.579-15.999-28.721-19.661-41.238-7.142l-73.14,73.141l-32-32V473.6h121.6V294.4l38.4,76.8l76.8-38.4 L421.578,141.908z M358.4,435.2h-51.2v-38.4h51.2V435.2z M358.4,294.4h-51.2V256h51.2V294.4z" th:attr="fill=${combination.color}"></path>
                                </g>
                            </svg>

                            <!-- 상의: 티셔츠 모양 -->
                            <svg th:if="${combination.mainCategory == '상의'}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="50" height="50">
                                <g>
                                    <path d="M509.681,228.36L412.159,59.425c-0.001-0.001-0.002-0.002-0.002-0.003c-12.211-21.14-34.959-34.274-59.367-34.274h-30.415 c-5.51,0-10.693,2.624-13.955,7.065l-35.401,48.204c-8.447,11.5-25.591,11.5-34.037,0l-35.402-48.204 c-3.262-4.442-8.443-7.065-13.955-7.065h-30.415c-24.408,0-47.156,13.133-59.37,34.278L2.32,228.36 c-4.779,8.281-1.937,18.873,6.339,23.651l83.751,48.344c6.526,3.768,14.487,2.803,19.908-1.829v171.014 c0,9.562,7.752,17.314,17.314,17.314h252.737c9.562,0,17.314-7.752,17.314-17.314V298.526c5.42,4.631,13.383,5.596,19.908,1.83 l83.751-48.344C511.621,247.231,514.457,236.638,509.681,228.36z" th:attr="fill=${combination.color}"/>
                                </g>
                            </svg>

                            <!-- 바지: 바지 모양 -->
                            <svg th:if="${combination.mainCategory == '바지'}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="50" height="50">
                                <path d="M2 16L3 0H13L14 16H9L8.375 6H7.625L7 16H2Z" th:attr="fill=${combination.color}"/>
                            </svg>
                            <!-- 스커트: 스커트 모양 -->
                            <path th:if="${combination.mainCategory == '스커트'}" d="M15,5 L35,5 L30,35 L20,35 Z" th:attr="fill=${combination.color}"></path>
                        </svg>
                    </div>
                </div>


            </div>
        </div>

        <div class="outfit-display">
            <div class="outfit-display-header">
                <h2>추천 상품</h2>
                <!-- Swiper 버튼들 -->
                <div class="swiper-buttons">
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-button-next"></div>
                </div>
            </div>
            <!-- Swiper -->
            <div class="swiper productSwiper">
                <div class="swiper-wrapper">
                    <div th:each="mainCategory : ${clothingProducts}" class="swiper-slide">
                        <div class="product-categories">
                            <h3 th:text="${mainCategory.key}" class="main-category-title"></h3>
                            <div class="category-container">
                                <!-- 서브 카테고리 버튼들 -->
                                <div class="sub-category-buttons">
                                    <button class="scroll-button-left">
                                        <img src="/images/ui-icons/arrow-left.svg" alt="Left Arrow">
                                    </button>
                                    <div class="sub-category-buttons-container">
                                        <button th:each="category : ${mainCategory.value}"
                                                class="sub-category-button"
                                                th:data-category="${category.key}"
                                                onclick="showProducts(this.getAttribute('data-category'))">
                                            <span th:text="${category.key}"></span>
                                        </button>
                                    </div>
                                    <button class="scroll-button-right">
                                        <img src="/images/ui-icons/arrow-right.svg" alt="Right Arrow">
                                    </button>
                                </div>
                                <!-- 상품 표시 영역 -->
                                <div class="products-display-area">
                                    <div th:each="category : ${mainCategory.value}"
                                         th:id="'products-' + ${#strings.replace(category.key, ' ', '-')}"
                                         class="product-list hidden">
                                        <div class="product-item" th:each="product : ${category.value}">
                                            <a th:href="${product.link}" target="_self" class="product-link">
                                                <img th:src="${product.imageUrl}" th:alt="상품이미지" class="product-image">
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="swiper-pagination"></div>
            </div>
        </div>
    </div>
</main>

<footer class="footer">
    <div class="container">
        <button onclick="scrollToSectionByClass('weather-info')">날씨 정보</button>
        <button onclick="scrollToSectionByClass('category-suggestions')">카테고리</button>
        <button onclick="scrollToSectionByClass('clothing-combination')">추천 조합</button>
        <button onclick="scrollToSectionByClass('outfit-display')">추천 의상</button>
    </div>
</footer>


<!-- 날씨 데이터가 없을 때 -->
<div th:if="${weatherData == null}" class="error-message">
    <p th:text="${message}">Location data not found in cookies.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="/js/productSwiper.js"></script>
<script src="/js/product-toggle.js"></script>
<script src="/js/scroll-buttons.js"></script>
<script src="/js/footer-buttons.js"></script>


<script src="/service-worker.js"></script>

<!-- PWA 서비스워커 등록 -->
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker 등록 성공:', registration);
                })
                .catch(err => {
                    console.log('ServiceWorker 등록 실패:', err);
                });
        });
    }
</script>

<script src="/js/weather-update.js"></script>

</body>
</html>